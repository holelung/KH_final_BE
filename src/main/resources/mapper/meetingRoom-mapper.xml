<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.kh.saintra.meetingroom.model.dao.MeetingRoomMapper">


	<!-- 주간 예약 조회 -->
	<select id="getWeeklyReservations" resultType="com.kh.saintra.meetingroom.model.dto.MeetingRoomResponseDTO">
	  SELECT
	    r.ID         			 AS Id,
	    r.ROOM_ID                AS roomId,
	    mr.ROOM_NAME             AS roomName,
	    mr.ROOM_LOCATION         AS roomLocation,
	    mr.CAPACITY              AS capacity,
	    r.RESERVE_DATE           AS reserveDate,
	    r.START_TIME             AS startTime,
	    r.END_TIME               AS endTime,
	    r.PURPOSE                AS purpose,
	    rr.RESERVER_TYPE         AS reserverType,
	    r.IS_ACTIVE              AS isActive,
	    r.RESERVER_ID			 AS reserverId,
	    
	    CASE
	      WHEN rr.RESERVER_TYPE = 'USER' THEN u.REALNAME
	      WHEN rr.RESERVER_TYPE = 'TEAM' THEN t.TEAM_NAME
	      ELSE NULL
	    END                      AS reserverName
	  FROM
	    TB_RESERVATION r
	  LEFT JOIN
	    TB_MEETING_ROOM mr ON (r.ROOM_ID = mr.ID)
	  LEFT JOIN
	    TB_RESERVER rr ON(rr.ID = rr.ID)
	  LEFT JOIN
	    TB_USER_RESERVER ur ON rr.RESERVER_TYPE = 'USER' AND (rr.ID = ur.RESERVER_ID)
	  LEFT JOIN
	    TB_USER u ON ur.USER_ID = u.ID
	  LEFT JOIN
	    TB_TEAM_RESERVER tr ON rr.RESERVER_TYPE = 'TEAM' AND (rr.ID = tr.RESERVER_ID)
	  LEFT JOIN
	    TB_TEAM t ON tr.TEAM_ID = t.ID
	  WHERE
	    r.RESERVE_DATE BETWEEN #{startDate} AND #{endDate}
	    AND r.IS_ACTIVE = 'Y'
	  ORDER BY
	    r.RESERVE_DATE, r.START_TIME
	</select>
	
</mapper>